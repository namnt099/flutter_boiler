default_platform(:android)

platform :android do
  desc "Build and distribute APK to Firebase"
  lane :deploy_firebase do
    flavor = ENV["FLAVOR"] || "product" # L·∫•y t·ª´ bi·∫øn m√¥i tr∆∞·ªùng, m·∫∑c ƒë·ªãnh l√† "product"
    UI.message "üöÄ Building flavor: #{flavor}" # Ki·ªÉm tra gi√° tr·ªã FLAVOR

    env_file = ".env.#{flavor}" 

    gradle(
      task: "assemble#{flavor.capitalize}Release",
      properties: {
        "target": "lib/main_#{flavor}.dart",
        "envFile": env_file,
        "flavor": flavor
      }
    )

    apk_path = "../build/app/outputs/apk/#{flavor}/release/app-#{flavor}-release.apk"

    firebase_app_distribution(
      app: "1:212347360763:android:3f0583c2edb094672ee75e",
      android_artifact_type: "APK",
      android_artifact_path: apk_path,
      groups: "test",
      release_notes: "Release notes for this #{flavor} build",
      firebase_cli_token: ENV["FIREBASE_TOKEN"]
    )
  end
end
